c78a494379b712913dab70250e829933
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const account_1 = __importDefault(require("@backoffice/accounts/domain/account"));
class BalanceSaver {
    constructor(repository, bus) {
        this.repository = repository;
        this.bus = bus;
    }
    async run(accountId, amount) {
        let account = await this.repository.get(accountId);
        if (!account)
            account = account_1.default.createBalance(accountId, amount);
        else
            account.updateBalance(amount);
        await this.repository.save(account);
        await this.bus.publish(account.pullDomainEvents());
    }
}
exports.default = BalanceSaver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb3B0aXZhbWVkaWEvRG9jdW1lbnRzL1BlcnNvbmFsL2JhbmstYWNjb3VudC1tYW5hZ2VyL3NlcnZlci9jb250ZXh0cy9iYWNrb2ZmaWNlL2FjY291bnRzL2FwcGxpY2F0aW9uL3NhdmUvYmFsYW5jZVNhdmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBSUEsa0ZBQTBEO0FBRTFELE1BQXFCLFlBQVk7SUFLN0IsWUFBWSxVQUE2QixFQUFFLEdBQWE7UUFDcEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDbkIsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQUMsU0FBb0IsRUFBRSxNQUFjO1FBQzFDLElBQUksT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFbkQsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPLEdBQUcsaUJBQU8sQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDOztZQUM1RCxPQUFPLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRW5DLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7Q0FDSjtBQW5CRCwrQkFtQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvb3B0aXZhbWVkaWEvRG9jdW1lbnRzL1BlcnNvbmFsL2JhbmstYWNjb3VudC1tYW5hZ2VyL3NlcnZlci9jb250ZXh0cy9iYWNrb2ZmaWNlL2FjY291bnRzL2FwcGxpY2F0aW9uL3NhdmUvYmFsYW5jZVNhdmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBY2NvdW50UmVwb3NpdG9yeSBmcm9tICdAYmFja29mZmljZS9hY2NvdW50cy9kb21haW4vYWNjb3VudFJlcG9zaXRvcnknO1xuaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICdAc2hhcmVkL2RvbWFpbi9idXMvZXZlbnQvZXZlbnRCdXMnO1xuaW1wb3J0IHR5cGUgQWNjb3VudElkIGZyb20gJ0BiYWNrb2ZmaWNlL2FjY291bnRzL2RvbWFpbi9hY2NvdW50SWQnO1xuaW1wb3J0IHR5cGUgQW1vdW50IGZyb20gJ0BiYWNrb2ZmaWNlL2FjY291bnRzL2RvbWFpbi9hbW91bnQnO1xuaW1wb3J0IEFjY291bnQgZnJvbSAnQGJhY2tvZmZpY2UvYWNjb3VudHMvZG9tYWluL2FjY291bnQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCYWxhbmNlU2F2ZXIge1xuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogQWNjb3VudFJlcG9zaXRvcnk7XG5cbiAgICBwcml2YXRlIGJ1czogRXZlbnRCdXM7XG5cbiAgICBjb25zdHJ1Y3RvcihyZXBvc2l0b3J5OiBBY2NvdW50UmVwb3NpdG9yeSwgYnVzOiBFdmVudEJ1cykge1xuICAgICAgICB0aGlzLnJlcG9zaXRvcnkgPSByZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLmJ1cyA9IGJ1cztcbiAgICB9XG5cbiAgICBhc3luYyBydW4oYWNjb3VudElkOiBBY2NvdW50SWQsIGFtb3VudDogQW1vdW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGxldCBhY2NvdW50ID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5LmdldChhY2NvdW50SWQpO1xuXG4gICAgICAgIGlmICghYWNjb3VudCkgYWNjb3VudCA9IEFjY291bnQuY3JlYXRlQmFsYW5jZShhY2NvdW50SWQsIGFtb3VudCk7XG4gICAgICAgIGVsc2UgYWNjb3VudC51cGRhdGVCYWxhbmNlKGFtb3VudCk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5yZXBvc2l0b3J5LnNhdmUoYWNjb3VudCk7XG4gICAgICAgIGF3YWl0IHRoaXMuYnVzLnB1Ymxpc2goYWNjb3VudC5wdWxsRG9tYWluRXZlbnRzKCkpO1xuICAgIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==