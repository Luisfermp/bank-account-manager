cf4091b964f878818c02a95b81f77d69
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class EventBusMock {
    constructor() {
        this.publishSpy = jest.fn();
    }
    async publish(events) {
        this.publishSpy(events);
    }
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    addSubscribers(_subscribers) {
        //
    }
    assertLastPublishedEventIs(expectedEvent) {
        const publishSpyCalls = this.publishSpy.mock.calls, lastPublishSpyCall = publishSpyCalls[publishSpyCalls.length - 1], lastPublishedEvent = lastPublishSpyCall[0][0];
        expect(publishSpyCalls.length).toBeGreaterThan(0);
        expect(this.getDataFromDomainEvent(expectedEvent)).toMatchObject(this.getDataFromDomainEvent(lastPublishedEvent));
    }
    // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
    assertLastPublishedEventTypeIs(type) {
        const publishSpyCalls = this.publishSpy.mock.calls;
        expect(publishSpyCalls.length).toBeGreaterThan(0);
        // eslint-disable-next-line one-var
        const lastPublishSpyCall = publishSpyCalls[publishSpyCalls.length - 1], lastPublishedEvent = lastPublishSpyCall[0][0];
        expect(lastPublishedEvent).toBeInstanceOf(type);
    }
    assertLastPublishedEventsAre(events) {
        const publishSpyCalls = this.publishSpy.mock.calls, lastPublishSpyCall = publishSpyCalls[publishSpyCalls.length - 1], lastPublishedEvents = lastPublishSpyCall[0];
        expect(publishSpyCalls.length).toBeGreaterThan(0);
        expect(lastPublishedEvents).toHaveLength(events.length);
        lastPublishedEvents.forEach((publishedEvent, i) => {
            const expectedEvent = events[i];
            expect(this.getDataFromDomainEvent(expectedEvent)).toMatchObject(this.getDataFromDomainEvent(publishedEvent));
        });
    }
    assertPublishedEventsAre(events) {
        const { mock } = this.publishSpy, callsArgument = mock.calls.map((c) => this.getDataFromDomainEvent(c[0][0]));
        expect(mock.calls).toHaveLength(events.length);
        events.forEach((e) => {
            expect(callsArgument).toContainEqual(this.getDataFromDomainEvent(e));
        });
    }
    assertEmptyPublished() {
        const publishSpyCalls = this.publishSpy.mock.calls, lastPublishSpyCall = publishSpyCalls[publishSpyCalls.length - 1], lastPublishedEvents = lastPublishSpyCall[0];
        expect(lastPublishedEvents).toHaveLength(0);
    }
    assertNothingPublished() {
        const publishSpyCalls = this.publishSpy.mock.calls;
        expect(publishSpyCalls).toHaveLength(0);
    }
    getDataFromDomainEvent(event) {
        // eslint-disable-next-line @typescript-eslint/no-unused-vars
        const { eventId, occurredOn, ...attributes } = event;
        return attributes;
    }
}
exports.default = EventBusMock;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb3B0aXZhbWVkaWEvRG9jdW1lbnRzL1BlcnNvbmFsL2JhbmstYWNjb3VudC1tYW5hZ2VyL3NlcnZlci9jb250ZXh0cy9zaGFyZWQvX19tb2Nrc19fL2V2ZW50QnVzLm1vY2sudHMiLCJtYXBwaW5ncyI6Ijs7QUFNQSxNQUFxQixZQUFZO0lBQWpDO1FBQ1ksZUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQW9GbkMsQ0FBQztJQWxGRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQXFCO1FBQy9CLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVELDZEQUE2RDtJQUM3RCxjQUFjLENBQUMsWUFBa0Q7UUFDN0QsRUFBRTtJQUNOLENBQUM7SUFFRCwwQkFBMEIsQ0FBQyxhQUEwQjtRQUNqRCxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQzlDLGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxlQUFlLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUNoRSxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVsRCxNQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVsRCxNQUFNLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUM1RCxJQUFJLENBQUMsc0JBQXNCLENBQUMsa0JBQWtCLENBQUMsQ0FDbEQsQ0FBQztJQUNOLENBQUM7SUFFRCw2RUFBNkU7SUFDN0UsOEJBQThCLENBQUMsSUFBUztRQUNwQyxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFbkQsTUFBTSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbEQs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YWwvYmFuay1hY2NvdW50LW1hbmFnZXIvc2VydmVyL2NvbnRleHRzL3NoYXJlZC9fX21vY2tzX18vZXZlbnRCdXMubW9jay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBqZXN0L25vLXN0YW5kYWxvbmUtZXhwZWN0ICovXG4vKiBlc2xpbnQtZGlzYWJsZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzICovXG5pbXBvcnQgeyBFdmVudEJ1cyB9IGZyb20gJ0BzaGFyZWQvZG9tYWluL2J1cy9ldmVudC9ldmVudEJ1cyc7XG5pbXBvcnQgeyBEb21haW5FdmVudCB9IGZyb20gJ0BzaGFyZWQvZG9tYWluL2J1cy9ldmVudC9kb21haW5FdmVudCc7XG5pbXBvcnQgeyBEb21haW5FdmVudFN1YnNjcmliZXIgfSBmcm9tICdAc2hhcmVkL2RvbWFpbi9idXMvZXZlbnQvZG9tYWluRXZlbnRTdWJzY3JpYmVyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRXZlbnRCdXNNb2NrIGltcGxlbWVudHMgRXZlbnRCdXMge1xuICAgIHByaXZhdGUgcHVibGlzaFNweSA9IGplc3QuZm4oKTtcblxuICAgIGFzeW5jIHB1Ymxpc2goZXZlbnRzOiBEb21haW5FdmVudFtdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRoaXMucHVibGlzaFNweShldmVudHMpO1xuICAgIH1cblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBhZGRTdWJzY3JpYmVycyhfc3Vic2NyaWJlcnM6IERvbWFpbkV2ZW50U3Vic2NyaWJlcjxEb21haW5FdmVudD5bXSk6IHZvaWQge1xuICAgICAgICAvL1xuICAgIH1cblxuICAgIGFzc2VydExhc3RQdWJsaXNoZWRFdmVudElzKGV4cGVjdGVkRXZlbnQ6IERvbWFpbkV2ZW50KTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHB1Ymxpc2hTcHlDYWxscyA9IHRoaXMucHVibGlzaFNweS5tb2NrLmNhbGxzLFxuICAgICAgICAgICAgbGFzdFB1Ymxpc2hTcHlDYWxsID0gcHVibGlzaFNweUNhbGxzW3B1Ymxpc2hTcHlDYWxscy5sZW5ndGggLSAxXSxcbiAgICAgICAgICAgIGxhc3RQdWJsaXNoZWRFdmVudCA9IGxhc3RQdWJsaXNoU3B5Q2FsbFswXVswXTtcblxuICAgICAgICBleHBlY3QocHVibGlzaFNweUNhbGxzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICAgIGV4cGVjdCh0aGlzLmdldERhdGFGcm9tRG9tYWluRXZlbnQoZXhwZWN0ZWRFdmVudCkpLnRvTWF0Y2hPYmplY3QoXG4gICAgICAgICAgICB0aGlzLmdldERhdGFGcm9tRG9tYWluRXZlbnQobGFzdFB1Ymxpc2hlZEV2ZW50KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvZXhwbGljaXQtbW9kdWxlLWJvdW5kYXJ5LXR5cGVzXG4gICAgYXNzZXJ0TGFzdFB1Ymxpc2hlZEV2ZW50VHlwZUlzKHR5cGU6IGFueSk6IHZvaWQge1xuICAgICAgICBjb25zdCBwdWJsaXNoU3B5Q2FsbHMgPSB0aGlzLnB1Ymxpc2hTcHkubW9jay5jYWxscztcblxuICAgICAgICBleHBlY3QocHVibGlzaFNweUNhbGxzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBvbmUtdmFyXG4gICAgICAgIGNvbnN0IGxhc3RQdWJsaXNoU3B5Q2FsbCA9IHB1Ymxpc2hTcHlDYWxsc1twdWJsaXNoU3B5Q2FsbHMubGVuZ3RoIC0gMV0sXG4gICAgICAgICAgICBsYXN0UHVibGlzaGVkRXZlbnQgPSBsYXN0UHVibGlzaFNweUNhbGxbMF1bMF07XG5cbiAgICAgICAgZXhwZWN0KGxhc3RQdWJsaXNoZWRFdmVudCkudG9CZUluc3RhbmNlT2YodHlwZSk7XG4gICAgfVxuXG4gICAgYXNzZXJ0TGFzdFB1Ymxpc2hlZEV2ZW50c0FyZShldmVudHM6IERvbWFpbkV2ZW50W10pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcHVibGlzaFNweUNhbGxzID0gdGhpcy5wdWJsaXNoU3B5Lm1vY2suY2FsbHMsXG4gICAgICAgICAgICBsYXN0UHVibGlzaFNweUNhbGwgPSBwdWJsaXNoU3B5Q2FsbHNbcHVibGlzaFNweUNhbGxzLmxlbmd0aCAtIDFdLFxuICAgICAgICAgICAgbGFzdFB1Ymxpc2hlZEV2ZW50cyA9IGxhc3RQdWJsaXNoU3B5Q2FsbFswXTtcblxuICAgICAgICBleHBlY3QocHVibGlzaFNweUNhbGxzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgICBleHBlY3QobGFzdFB1Ymxpc2hlZEV2ZW50cykudG9IYXZlTGVuZ3RoKGV2ZW50cy5sZW5ndGgpO1xuXG4gICAgICAgIGxhc3RQdWJsaXNoZWRFdmVudHMuZm9yRWFjaCgocHVibGlzaGVkRXZlbnQ6IERvbWFpbkV2ZW50LCBpOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkRXZlbnQgPSBldmVudHNbaV07XG5cbiAgICAgICAgICAgIGV4cGVjdCh0aGlzLmdldERhdGFGcm9tRG9tYWluRXZlbnQoZXhwZWN0ZWRFdmVudCkpLnRvTWF0Y2hPYmplY3QoXG4gICAgICAgICAgICAgICAgdGhpcy5nZXREYXRhRnJvbURvbWFpbkV2ZW50KHB1Ymxpc2hlZEV2ZW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXNzZXJ0UHVibGlzaGVkRXZlbnRzQXJlKGV2ZW50czogRG9tYWluRXZlbnRbXSk6IHZvaWQge1xuICAgICAgICBjb25zdCB7IG1vY2sgfSA9IHRoaXMucHVibGlzaFNweSxcbiAgICAgICAgICAgIGNhbGxzQXJndW1lbnQgPSBtb2NrLmNhbGxzLm1hcCgoYykgPT4gdGhpcy5nZXREYXRhRnJvbURvbWFpbkV2ZW50KGNbMF1bMF0pKTtcblxuICAgICAgICBleHBlY3QobW9jay5jYWxscykudG9IYXZlTGVuZ3RoKGV2ZW50cy5sZW5ndGgpO1xuXG4gICAgICAgIGV2ZW50cy5mb3JFYWNoKChlKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoY2FsbHNBcmd1bWVudCkudG9Db250YWluRXF1YWwodGhpcy5nZXREYXRhRnJvbURvbWFpbkV2ZW50KGUpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXNzZXJ0RW1wdHlQdWJsaXNoZWQoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHB1Ymxpc2hTcHlDYWxscyA9IHRoaXMucHVibGlzaFNweS5tb2NrLmNhbGxzLFxuICAgICAgICAgICAgbGFzdFB1Ymxpc2hTcHlDYWxsID0gcHVibGlzaFNweUNhbGxzW3B1Ymxpc2hTcHlDYWxscy5sZW5ndGggLSAxXSxcbiAgICAgICAgICAgIGxhc3RQdWJsaXNoZWRFdmVudHMgPSBsYXN0UHVibGlzaFNweUNhbGxbMF07XG5cbiAgICAgICAgZXhwZWN0KGxhc3RQdWJsaXNoZWRFdmVudHMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9XG5cbiAgICBhc3NlcnROb3RoaW5nUHVibGlzaGVkKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBwdWJsaXNoU3B5Q2FsbHMgPSB0aGlzLnB1Ymxpc2hTcHkubW9jay5jYWxscztcblxuICAgICAgICBleHBlY3QocHVibGlzaFNweUNhbGxzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREYXRhRnJvbURvbWFpbkV2ZW50KGV2ZW50OiBEb21haW5FdmVudCk6IGFueSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICAgICAgY29uc3QgeyBldmVudElkLCBvY2N1cnJlZE9uLCAuLi5hdHRyaWJ1dGVzIH0gPSBldmVudDtcblxuICAgICAgICByZXR1cm4gYXR0cmlidXRlcztcbiAgICB9XG59XG4iXSwidmVyc2lvbiI6M30=