968b099e288552eb5106be52ebb9507b
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const accountNotFound_1 = __importDefault(require("@backoffice/accounts/domain/accountNotFound"));
class BalanceSaver {
    constructor(repository, bus) {
        this.repository = repository;
        this.bus = bus;
    }
    async run(accountId, amount) {
        const account = await this.repository.get(accountId);
        if (!account) {
            throw new accountNotFound_1.default(accountId.value);
        }
        account.updateBalance(amount);
        await this.repository.save(account);
        await this.bus.publish(account.pullDomainEvents());
    }
}
exports.default = BalanceSaver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb3B0aXZhbWVkaWEvRG9jdW1lbnRzL1BlcnNvbmFsL2JhbmstYWNjb3VudC1tYW5hZ2VyL3NlcnZlci9jb250ZXh0cy9iYWNrb2ZmaWNlL2FjY291bnRzL2FwcGxpY2F0aW9uL3NhdmUvYmFsYW5jZVNhdmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBSUEsa0dBQTBFO0FBRTFFLE1BQXFCLFlBQVk7SUFLN0IsWUFBWSxVQUE2QixFQUFFLEdBQWE7UUFDcEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDbkIsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQUMsU0FBb0IsRUFBRSxNQUFjO1FBQzFDLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFckQsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNWLE1BQU0sSUFBSSx5QkFBZSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM5QztRQUVELE9BQU8sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFOUIsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwQyxNQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7SUFDdkQsQ0FBQztDQUNKO0FBdEJELCtCQXNCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9vcHRpdmFtZWRpYS9Eb2N1bWVudHMvUGVyc29uYWwvYmFuay1hY2NvdW50LW1hbmFnZXIvc2VydmVyL2NvbnRleHRzL2JhY2tvZmZpY2UvYWNjb3VudHMvYXBwbGljYXRpb24vc2F2ZS9iYWxhbmNlU2F2ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFjY291bnRSZXBvc2l0b3J5IGZyb20gJ0BiYWNrb2ZmaWNlL2FjY291bnRzL2RvbWFpbi9hY2NvdW50UmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBFdmVudEJ1cyB9IGZyb20gJ0BzaGFyZWQvZG9tYWluL2J1cy9ldmVudC9ldmVudEJ1cyc7XG5pbXBvcnQgdHlwZSBBY2NvdW50SWQgZnJvbSAnQGJhY2tvZmZpY2UvYWNjb3VudHMvZG9tYWluL2FjY291bnRJZCc7XG5pbXBvcnQgdHlwZSBBbW91bnQgZnJvbSAnQGJhY2tvZmZpY2UvYWNjb3VudHMvZG9tYWluL2Ftb3VudCc7XG5pbXBvcnQgQWNjb3VudE5vdEZvdW5kIGZyb20gJ0BiYWNrb2ZmaWNlL2FjY291bnRzL2RvbWFpbi9hY2NvdW50Tm90Rm91bmQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCYWxhbmNlU2F2ZXIge1xuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogQWNjb3VudFJlcG9zaXRvcnk7XG5cbiAgICBwcml2YXRlIGJ1czogRXZlbnRCdXM7XG5cbiAgICBjb25zdHJ1Y3RvcihyZXBvc2l0b3J5OiBBY2NvdW50UmVwb3NpdG9yeSwgYnVzOiBFdmVudEJ1cykge1xuICAgICAgICB0aGlzLnJlcG9zaXRvcnkgPSByZXBvc2l0b3J5O1xuICAgICAgICB0aGlzLmJ1cyA9IGJ1cztcbiAgICB9XG5cbiAgICBhc3luYyBydW4oYWNjb3VudElkOiBBY2NvdW50SWQsIGFtb3VudDogQW1vdW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGFjY291bnQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuZ2V0KGFjY291bnRJZCk7XG5cbiAgICAgICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgQWNjb3VudE5vdEZvdW5kKGFjY291bnRJZC52YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBhY2NvdW50LnVwZGF0ZUJhbGFuY2UoYW1vdW50KTtcblxuICAgICAgICBhd2FpdCB0aGlzLnJlcG9zaXRvcnkuc2F2ZShhY2NvdW50KTtcbiAgICAgICAgYXdhaXQgdGhpcy5idXMucHVibGlzaChhY2NvdW50LnB1bGxEb21haW5FdmVudHMoKSk7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9