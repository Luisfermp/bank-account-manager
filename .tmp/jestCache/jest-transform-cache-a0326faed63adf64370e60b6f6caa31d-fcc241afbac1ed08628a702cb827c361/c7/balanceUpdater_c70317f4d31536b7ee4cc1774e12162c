5d61161873aae144b29dd6dd356844b9
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const accountNotFound_1 = __importDefault(require("@backoffice/accounts/domain/accountNotFound"));
class BalanceUpdater {
    constructor(repository, bus) {
        this.repository = repository;
        this.bus = bus;
    }
    async run(accountId, amount) {
        const account = await this.repository.get(accountId);
        if (!account) {
            throw new accountNotFound_1.default(accountId.value);
        }
        account.updateBalance(amount);
        await this.repository.update(account);
        await this.bus.publish(account.pullDomainEvents());
    }
}
exports.default = BalanceUpdater;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb3B0aXZhbWVkaWEvRG9jdW1lbnRzL1BlcnNvbmFsL2JhbmstYWNjb3VudC1tYW5hZ2VyL3NlcnZlci9jb250ZXh0cy9iYWNrb2ZmaWNlL2FjY291bnRzL2FwcGxpY2F0aW9uL3VwZGF0ZS9iYWxhbmNlVXBkYXRlci50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUlBLGtHQUEwRTtBQUUxRSxNQUFxQixjQUFjO0lBSy9CLFlBQVksVUFBNkIsRUFBRSxHQUFhO1FBQ3BELElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ25CLENBQUM7SUFFRCxLQUFLLENBQUMsR0FBRyxDQUFDLFNBQW9CLEVBQUUsTUFBYztRQUMxQyxNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXJELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDVixNQUFNLElBQUkseUJBQWUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDOUM7UUFFRCxPQUFPLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRTlCLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEMsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7Q0FDSjtBQXRCRCxpQ0FzQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvb3B0aXZhbWVkaWEvRG9jdW1lbnRzL1BlcnNvbmFsL2JhbmstYWNjb3VudC1tYW5hZ2VyL3NlcnZlci9jb250ZXh0cy9iYWNrb2ZmaWNlL2FjY291bnRzL2FwcGxpY2F0aW9uL3VwZGF0ZS9iYWxhbmNlVXBkYXRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWNjb3VudFJlcG9zaXRvcnkgZnJvbSAnQGJhY2tvZmZpY2UvYWNjb3VudHMvZG9tYWluL2FjY291bnRSZXBvc2l0b3J5JztcbmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAnQHNoYXJlZC9kb21haW4vYnVzL2V2ZW50L2V2ZW50QnVzJztcbmltcG9ydCB0eXBlIEFjY291bnRJZCBmcm9tICdAYmFja29mZmljZS9hY2NvdW50cy9kb21haW4vYWNjb3VudElkJztcbmltcG9ydCB0eXBlIEFtb3VudCBmcm9tICdAYmFja29mZmljZS9hY2NvdW50cy9kb21haW4vYW1vdW50JztcbmltcG9ydCBBY2NvdW50Tm90Rm91bmQgZnJvbSAnQGJhY2tvZmZpY2UvYWNjb3VudHMvZG9tYWluL2FjY291bnROb3RGb3VuZCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJhbGFuY2VVcGRhdGVyIHtcbiAgICBwcml2YXRlIHJlcG9zaXRvcnk6IEFjY291bnRSZXBvc2l0b3J5O1xuXG4gICAgcHJpdmF0ZSBidXM6IEV2ZW50QnVzO1xuXG4gICAgY29uc3RydWN0b3IocmVwb3NpdG9yeTogQWNjb3VudFJlcG9zaXRvcnksIGJ1czogRXZlbnRCdXMpIHtcbiAgICAgICAgdGhpcy5yZXBvc2l0b3J5ID0gcmVwb3NpdG9yeTtcbiAgICAgICAgdGhpcy5idXMgPSBidXM7XG4gICAgfVxuXG4gICAgYXN5bmMgcnVuKGFjY291bnRJZDogQWNjb3VudElkLCBhbW91bnQ6IEFtb3VudCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBhY2NvdW50ID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5LmdldChhY2NvdW50SWQpO1xuXG4gICAgICAgIGlmICghYWNjb3VudCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEFjY291bnROb3RGb3VuZChhY2NvdW50SWQudmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgYWNjb3VudC51cGRhdGVCYWxhbmNlKGFtb3VudCk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZShhY2NvdW50KTtcbiAgICAgICAgYXdhaXQgdGhpcy5idXMucHVibGlzaChhY2NvdW50LnB1bGxEb21haW5FdmVudHMoKSk7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9